<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="699px" height="458px" viewBox="-0.5 -0.5 699 458"><defs><clipPath id="mx-clip-335-125-331-144-0"><rect x="335" y="125" width="331" height="144"/></clipPath><clipPath id="mx-clip-4-31-242-164-0"><rect x="4" y="31" width="242" height="164"/></clipPath><clipPath id="mx-clip-54-255-222-84-0"><rect x="54" y="255" width="222" height="84"/></clipPath><clipPath id="mx-clip-54-385-192-54-0"><rect x="54" y="385" width="192" height="54"/></clipPath><clipPath id="mx-clip-417-335-159-124-0"><rect x="417" y="335" width="159" height="124"/></clipPath></defs><g><g><path d="M 331 120 L 331 94 L 670 94 L 670 120" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 331 120 L 331 264 L 670 264 L 670 120" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 331 120 L 670 120" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px"><text x="500" y="113.5">Plaintext</text></g></g><g><rect x="331" y="120" width="339" height="144" fill="#ffffff" stroke="none" pointer-events="all"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" clip-path="url(#mx-clip-335-125-331-144-0)" font-size="12px"><text x="336.5" y="137.5">string version = 1;</text><text x="336.5" y="151.5">oneof payload {</text><text x="336.5" y="165.5">    bytes common_msg = 2;</text><text x="336.5" y="179.5">    bytes common_sync_msg = 3;</text><text x="336.5" y="207.5">    UserDevicesBundle user_devices_bundle = 11;</text><text x="336.5" y="221.5">    GroupPreKeyBundle group_pre_key_bundle = 12;</text><text x="336.5" y="235.5">    GroupUpdateKeyBundle group_update_key_bundle = 13;</text><text x="336.5" y="249.5">};</text></g></g><g><path d="M 0 26 L 0 0 L 250 0 L 250 26" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 0 26 L 0 190 L 250 190 L 250 26" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 0 26 L 250 26" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px"><text x="124.5" y="19.5">E2eeMsg</text></g></g><g><rect x="0" y="26" width="250" height="164" fill="#ffffff" stroke="none" pointer-events="all"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" clip-path="url(#mx-clip-4-31-242-164-0)" font-size="12px"><text x="5.5" y="43.5">string version = 1;</text><text x="5.5" y="57.5">E2eeAddress from = 2;</text><text x="5.5" y="71.5">E2eeAddress to = 3;</text><text x="5.5" y="85.5">string msg_id = 4;</text><text x="5.5" y="99.5">string session_id = 5;</text><text x="5.5" y="113.5">NotifLevel notif_level = 6;</text><text x="5.5" y="127.5">oneof payload {</text><text x="5.5" y="141.5">  One2oneMsgPayload one2one_msg = 11;</text><text x="5.5" y="155.5">  GroupMsgPayload group_msg = 12;</text><text x="5.5" y="169.5">};</text></g></g><g><path d="M 50 250 L 50 224 L 280 224 L 280 250" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 50 250 L 50 334 L 280 334 L 280 250" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 50 250 L 280 250" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px"><text x="164.5" y="243.5">One2oneMsgPayload</text></g></g><g><rect x="50" y="250" width="230" height="84" fill="#ffffff" stroke="none" pointer-events="all"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" clip-path="url(#mx-clip-54-255-222-84-0)" font-size="12px"><text x="55.5" y="267.5">uint32 sequence = 1;</text><text x="55.5" y="281.5">bytes ciphertext = 2;</text><text x="55.5" y="295.5">bytes ratchet_key = 3;</text><text x="55.5" y="309.5">uint32 root_sequence = 4;</text><text x="55.5" y="323.5">uint32 sending_message_sequence = 5;</text></g></g><g><path d="M 50 380 L 50 354 L 250 354 L 250 380" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 50 380 L 50 434 L 250 434 L 250 380" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 50 380 L 250 380" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px"><text x="149.5" y="373.5">GroupMsgPayload</text></g></g><g><rect x="50" y="380" width="200" height="54" fill="#ffffff" stroke="none" pointer-events="all"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" clip-path="url(#mx-clip-54-385-192-54-0)" font-size="12px"><text x="55.5" y="397.5">uint32 sequence = 1;</text><text x="55.5" y="411.5">bytes ciphertext = 2;</text><text x="55.5" y="425.5">bytes signature = 3;</text></g></g><g><path d="M 241 139.16 L 269 139.17 L 269 214 L 29 214 L 29 235 L 43.63 235" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 48.88 235 L 41.88 238.5 L 43.63 235 L 41.88 231.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 223 274 L 293 274 L 293 105 L 310.84 104.99" fill="none" stroke="#b85450" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="stroke"/><path d="M 316.84 104.98 L 308.85 108.99 L 310.84 104.99 L 308.84 100.99 Z" fill="#b85450" stroke="#b85450" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 413 330 L 413 304 L 580 304 L 580 330" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 413 330 L 413 454 L 580 454 L 580 330" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 413 330 L 580 330" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px"><text x="496" y="323.5">GroupPreKeyBundle</text></g></g><g><rect x="413" y="330" width="167" height="124" fill="#ffffff" stroke="none" pointer-events="all"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" clip-path="url(#mx-clip-417-335-159-124-0)" font-size="12px"><text x="418.5" y="347.5">string version = 1;</text><text x="418.5" y="361.5">uint32 e2ee_pack_id = 2;</text><text x="418.5" y="375.5">E2eeAddress sender = 3;</text><text x="418.5" y="389.5">string session_id = 4;</text><text x="418.5" y="403.5">string old_session_id = 5;</text><text x="418.5" y="417.5">GroupInfo group_info = 6;</text><text x="418.5" y="431.5">uint32 sequence = 7;</text><text x="418.5" y="445.5">bytes group_seed = 8;</text></g></g><g><path d="M 223 390 L 293 390 L 293 105 L 310.76 105" fill="none" stroke="#b85450" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="stroke"/><path d="M 316.76 105 L 308.76 109 L 310.76 105 L 308.76 101 Z" fill="#b85450" stroke="#b85450" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="286" y="68" width="80" height="20" fill="#f8cecc" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 78px; margin-left: 326px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">Decryption</div></div></div></foreignObject><text x="326" y="82" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Decryption</text></switch></g></g><g><rect x="286" y="413" width="80" height="20" fill="#d5e8d4" stroke="#82b366" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 423px; margin-left: 326px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">Encryption</div></div></div></foreignObject><text x="326" y="427" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Encryption</text></switch></g></g><g><path d="M 239.24 280 L 301 280 L 301 111 L 327.08 110.98" fill="none" stroke="#82b366" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="2 2" pointer-events="stroke"/><path d="M 233.24 280 L 241.24 276 L 239.24 280 L 241.24 284 Z" fill="#82b366" stroke="#82b366" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 239.24 400 L 301 400 L 301 111 L 327 111" fill="none" stroke="#82b366" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="2 2" pointer-events="stroke"/><path d="M 233.24 400 L 241.24 396 L 239.24 400 L 241.24 404 Z" fill="#82b366" stroke="#82b366" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 630 219.94 L 690 220 L 690 280 L 380 280 L 380 318 L 405.3 317.36" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 410.55 317.23 L 403.64 320.9 L 405.3 317.36 L 403.46 313.91 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 240 149.98 L 260 150 L 260 200 L 20 200 L 20 366 L 41.63 366" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 46.88 366 L 39.88 369.5 L 41.63 366 L 39.88 362.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g></g></svg>