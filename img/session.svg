<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="638px" height="564px" viewBox="-0.5 -0.5 638 564"><defs><clipPath id="mx-clip-4-31-232-304-0"><rect x="4" y="31" width="232" height="304"/></clipPath><clipPath id="mx-clip-276-141-302-114-0"><rect x="276" y="141" width="302" height="114"/></clipPath><clipPath id="mx-clip-276-511-192-54-0"><rect x="276" y="511" width="192" height="54"/></clipPath><clipPath id="mx-clip-276-411-192-54-0"><rect x="276" y="411" width="192" height="54"/></clipPath><clipPath id="mx-clip-510-473-122-44-0"><rect x="510" y="473" width="122" height="44"/></clipPath><clipPath id="mx-clip-276-321-162-44-0"><rect x="276" y="321" width="162" height="44"/></clipPath><clipPath id="mx-clip-510-361-122-44-0"><rect x="510" y="361" width="122" height="44"/></clipPath></defs><g><g><path d="M 0 26 L 0 0 L 240 0 L 240 26" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 0 26 L 0 330 L 240 330 L 240 26" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 0 26 L 240 26" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px"><text x="119.5" y="19.5">Session</text></g></g><g><rect x="0" y="26" width="240" height="304" fill="#ffffff" stroke="none" pointer-events="all"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" clip-path="url(#mx-clip-4-31-232-304-0)" font-size="12px"><text x="5.5" y="43.5">string version = 1;</text><text x="5.5" y="57.5">uint32 e2ee_pack_id = 2;</text><text x="5.5" y="71.5">string session_id = 3;</text><text x="5.5" y="85.5">E2eeAddress our_address = 4;</text><text x="5.5" y="99.5">E2eeAddress their_address = 5;</text><text x="5.5" y="127.5">Ratchet ratchet = 11;</text><text x="5.5" y="141.5">bytes associated_data = 12;</text><text x="5.5" y="155.5">bytes temp_shared_secret = 13;</text><text x="5.5" y="169.5">bytes fingerprint = 14;</text><text x="5.5" y="197.5">KeyPair alice_base_key = 21;</text><text x="5.5" y="211.5">uint32 bob_signed_pre_key_id = 22;</text><text x="5.5" y="225.5">uint32 bob_one_time_pre_key_id = 23;</text><text x="5.5" y="239.5">repeated bytes pre_shared_input_list = 24;</text><text x="5.5" y="267.5">bool f2f = 31;</text><text x="5.5" y="281.5">bool responded = 32;</text><text x="5.5" y="295.5">int64 invite_t = 33;</text><text x="5.5" y="309.5">bool short_term = 34;</text></g></g><g><path d="M 271.5 136 L 271.5 110 L 581.5 110 L 581.5 136" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 271.5 136 L 271.5 250 L 581.5 250 L 581.5 136" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 271.5 136 L 581.5 136" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px"><text x="426" y="129.5">Ratchet</text></g></g><g><rect x="271.5" y="136" width="310" height="114" fill="#ffffff" stroke="none" pointer-events="all"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" clip-path="url(#mx-clip-276-141-302-114-0)" font-size="12px"><text x="277" y="153.5">bytes root_key = 1;</text><text x="277" y="167.5">uint32 root_sequence = 2;</text><text x="277" y="181.5">uint32 sending_message_sequence = 3;</text><text x="277" y="195.5">uint32 received_message_sequence = 4;</text><text x="277" y="209.5">SenderChainNode sender_chain = 5;</text><text x="277" y="223.5">ReceiverChainNode receiver_chain = 6;</text><text x="277" y="237.5">repeated SkippedMsgKeyNode skipped_msg_keys = 7;</text></g></g><g><path d="M 271.5 506 L 271.5 480 L 471.5 480 L 471.5 506" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 271.5 506 L 271.5 560 L 471.5 560 L 471.5 506" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 271.5 506 L 471.5 506" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px"><text x="371" y="499.5">SenderChainNode</text></g></g><g><rect x="271.5" y="506" width="200" height="54" fill="#ffffff" stroke="none" pointer-events="all"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" clip-path="url(#mx-clip-276-511-192-54-0)" font-size="12px"><text x="277" y="523.5">bytes our_ratchet_public_key = 1;</text><text x="277" y="537.5">bytes their_ratchet_public_key = 2;</text><text x="277" y="551.5">ChainKey chain_key = 3;</text></g></g><g><path d="M 271.5 406 L 271.5 380 L 471.5 380 L 471.5 406" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 271.5 406 L 271.5 460 L 471.5 460 L 471.5 406" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 271.5 406 L 471.5 406" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px"><text x="371" y="399.5">ReceiverChainNode</text></g></g><g><rect x="271.5" y="406" width="200" height="54" fill="#ffffff" stroke="none" pointer-events="all"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" clip-path="url(#mx-clip-276-411-192-54-0)" font-size="12px"><text x="277" y="423.5">bytes their_ratchet_public_key = 1;</text><text x="277" y="437.5">bytes our_ratchet_private_key = 2;</text><text x="277" y="451.5">ChainKey chain_key = 3;</text></g></g><g><path d="M 506 468 L 506 442 L 636 442 L 636 468" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 506 468 L 506 512 L 636 512 L 636 468" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 506 468 L 636 468" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px"><text x="570.5" y="461.5">ChainKey</text></g></g><g><rect x="506" y="468" width="130" height="44" fill="#ffffff" stroke="none" pointer-events="all"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" clip-path="url(#mx-clip-510-473-122-44-0)" font-size="12px"><text x="511.5" y="485.5">uint32 index = 1;</text><text x="511.5" y="499.5">bytes shared_key = 2;</text></g></g><g><path d="M 271.5 316 L 271.5 290 L 441.5 290 L 441.5 316" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 271.5 316 L 271.5 360 L 441.5 360 L 441.5 316" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 271.5 316 L 441.5 316" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px"><text x="356" y="309.5">SkippedMsgKeyNode</text></g></g><g><rect x="271.5" y="316" width="170" height="44" fill="#ffffff" stroke="none" pointer-events="all"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" clip-path="url(#mx-clip-276-321-162-44-0)" font-size="12px"><text x="277" y="333.5">bytes ratchet_key_public = 1;</text><text x="277" y="347.5">MsgKey msg_key = 2;</text></g></g><g><path d="M 506 356 L 506 330 L 636 330 L 636 356" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 506 356 L 506 400 L 636 400 L 636 356" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 506 356 L 636 356" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="14px"><text x="570.5" y="349.5">MsgKey</text></g></g><g><rect x="506" y="356" width="130" height="44" fill="#ffffff" stroke="none" pointer-events="all"/></g><g><g fill="rgb(0, 0, 0)" font-family="Helvetica" clip-path="url(#mx-clip-510-361-122-44-0)" font-size="12px"><text x="511.5" y="373.5">uint32 index = 1;</text><text x="511.5" y="387.5">bytes derived_key = 2;</text></g></g><g><path d="M 126 124 L 263.58 124" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 268.83 124 L 261.83 127.5 L 263.58 124 L 261.83 120.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 265.13 307.54 L 261 307.57 L 261 235 L 276 235" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 270.38 307.51 L 263.41 311.06 L 265.13 307.54 L 263.36 304.06 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 264.53 389.59 L 256 389.57 L 256 220 L 276 220" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 269.78 389.6 L 262.78 393.08 L 264.53 389.59 L 262.79 386.08 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 264.63 490 L 251 490 L 251 205 L 276 205" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 269.88 490 L 262.88 493.5 L 264.63 490 L 262.88 486.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 411 345 L 499.63 345" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 504.88 345 L 497.88 348.5 L 499.63 345 L 497.88 341.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 436 450 L 499.63 450" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 504.88 450 L 497.88 453.5 L 499.63 450 L 497.88 446.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><path d="M 436 550 L 486 550 L 486 459.57 L 499.63 459.52" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 504.88 459.5 L 497.89 463.03 L 499.63 459.52 L 497.87 456.03 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g></g></svg>